<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="google-site-verification" content="zrVlHARQzSGPX8n0jKJdP_fCO0AvtLXxoPmYkJh-oXw"/><meta name="description" content="Act local, think global with DotIN13!"><meta name="keywords" content="Apple Silicon, MacBook, Rbenv, Ruby, and Homebrew"><meta name="theme-color" content="#ff94c2"><meta lang="zh"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png?v=2bA3g2vyYK"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png?v=2bA3g2vyYK"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png?v=2bA3g2vyYK"><link rel="mask-icon" href="/assets/img/favicon/safari-pinned-tab.svg?v=2bA3g2vyYK" color="#dc2267"><link rel="shortcut icon" href="/assets/img/favicon/favicon.ico?v=2bA3g2vyYK"><meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/img/favicon/browserconfig.xml?v=2bA3g2vyYK"><meta property="og:title" content="在M1 MacBook上优雅地安装Rbenv+Ruby - DOTIN13'S BLOG"><meta property="og:type" content="article"><meta property="og:description" content="Ruby on M1 MacBook 看起来有不少尝鲜购入M1 MacBook的朋友装上了x86的homebrew，导致在编译Ruby时遇到了错误。事实上，如果使用了正确的ARM64 Homebrew，就已经可以正常地编译使用rbenv+Ruby了。 My Ruby Environment 系统自带的是Ruby-2.6.3，我已经成功使用rbenv安装了2.7.2用来写作Jeky..."><meta property="article:published_time" content="2021-02-19T00:00:00Z"><meta property="article:author" content="DotIN13"><meta property="article:tag" content="Apple Silicon"><meta property="article:tag" content="MacBook"><meta property="article:tag" content="Rbenv"><meta property="article:tag" content="Ruby"><meta property="article:tag" content="Homebrew"><meta property="og:image" content="https://www.wannaexpresso.com/assets/img/orange.webp"><meta property="og:url" content="https://www.wannaexpresso.com/2021/02/19/m1-macbook-rbenv/"><meta property="og:site_name" content="DOTIN13'S BLOG"><link rel="canonical" href="https://www.wannaexpresso.com/2021/02/19/m1-macbook-rbenv/"><script src="/assets/public/application-bundle.js"></script><link rel="stylesheet" href="/assets/public/application.css"><script src="/assets/public/posts-bundle.js"></script><title>在M1 MacBook上优雅地安装Rbenv+Ruby - DOTIN13'S BLOG</title></head><body><main class="container"><section class="about"><div class="about-header"><div class="about-title"><a href="/" id="avatar" data-caption="DotIN13" data-webpack="true" data-path="/assets/img/orange.webp"></a><h2 id="title"><a href="/">DotIN13</a></h2></div><p class="tagline">LACKAWANNA<br>EXPRESSO</p></div><div class="buttons"><a href="/en-us/" class="language-selection button icon-translate" aria-label="Change locale to English."></a><a href="/feed.xml" class="feed button icon-rss_feed" aria-label="RSS Feed"></a><input type="checkbox" class="dark-mode-toggle" aria-label="dark-mode-switch"><a href="#" aria-label="Click to toggle darkmode." class="button"><span class="icon-moon"></span><span class="icon-sun"></span></a><a href="#" id="pwa-install" class="install button icon-install disabled" aria-label="Install as Web Application"><span>Install</span></a></div><ul class="social condensed"><li><a target="_blank" rel="noreferrer" href="https://github.com/DotIN13" aria-label="GitHub Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://www.facebook.com/peter.zhang.1466" aria-label="Facebook Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://twitter.com/DotIN13" aria-label="Twitter Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://space.bilibili.com/4471331" aria-label="Bilibili Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="icon-bilibili fa-stack-1x fa-inverse"></i></span></a></li></ul><nav class="navigation condensed"><ul><li><a href="/about">About</a></li><li><a href="/archive">Archive</a></li></ul></nav><section class="about-footer condensed"><div><a href="https://icp.gov.moe" rel="noreferrer" target="_blank">Moe ICP </a><a href="https://icp.gov.moe/?keyword=20201620" target="_blank" rel="noreferrer">20201620</a></div><div><a rel="noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC-BY-SA 4.0</a></div></section></section><section class="content"><div class="post-container"><a class="post-link" href="/2021/02/19/m1-macbook-rbenv/"><h2 class="post-title">在M1 MacBook上优雅地安装Rbenv+Ruby</h2><h3 class="post-subtitle">Using Rbenv+Ruby on M1 MacBook</h3></a><div class="post-meta"><div class="post-categories"><a class="button" href="/archive/?tag=Apple+Silicon" title="Apple Silicon">Apple Silicon</a><a class="button" href="/archive/?tag=MacBook" title="MacBook">MacBook</a><a class="button" href="/archive/?tag=Rbenv" title="Rbenv">Rbenv</a><a class="button" href="/archive/?tag=Ruby" title="Ruby">Ruby</a><a class="button" href="/archive/?tag=Homebrew" title="Homebrew">Homebrew</a></div><div class="post-misc"><div class="post-date"><i class="icon-calendar"></i>Feb 19, 2021</div></div></div><div class="post"><h2 id="ruby-on-m1-macbook"><a href="#ruby-on-m1-macbook">#</a> Ruby on M1 MacBook </h2><p>看起来有不少尝鲜购入M1 MacBook的朋友装上了x86的homebrew，导致在编译Ruby时遇到了错误。事实上，如果使用了正确的ARM64 Homebrew，就已经可以正常地编译使用rbenv+Ruby了。</p><div class="post-img"><a href="/assets/img/in-post/post-macbook/ruby-versions.png" data-fancybox="gallery" data-caption="My Ruby Environment" data-path="post-macbook/ruby-versions.png" data-webpack="true"></a><em>My Ruby Environment</em></div><p>系统自带的是Ruby-2.6.3，我已经成功使用rbenv安装了2.7.2用来写作Jekyll，并且准备用3.0.0来继续开发我的Rails项目。</p><h2 id="安装步骤"><a href="#安装步骤">#</a> 安装步骤 </h2><h3 id="1-homebrew"><a href="#1-homebrew">#</a> 1. Homebrew </h3><p>Ruby编译需要安装ARM64版本的openssl，所以需要安装3.0.0以上版本适用于Apple Silicon的Homebrew。默认运行<a href="[ Homebrewbrew.sh](https://brew.sh/)">官方网站</a>的脚本即可安装正确版本的Homebrew，新版Homebrew的工作目录在<code class="language-plaintext highlighter-rouge">/opt/homebrew</code>。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/bash <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div><p>脚本全自动运行，按照提示安装即可，可以使用<code class="language-plaintext highlighter-rouge">brew -v</code>查看brew版本，并确保brew被安装到了<code class="language-plaintext highlighter-rouge">/opt/homebrew</code>。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew <span class="nt">-v</span>
Homebrew 3.0.1-93-g53d840c
Homebrew/homebrew-core <span class="o">(</span>git revision 70345<span class="p">;</span> last commit 2021-02-17<span class="o">)</span>
Homebrew/homebrew-cask <span class="o">(</span>git revision 0ab858<span class="p">;</span> last commit 2021-02-18<span class="o">)</span>
<span class="nv">$ </span>which brew
/opt/homebrew/bin/brew
</code></pre></div></div><h3 id="2-安装rbenvreadline和openssl"><a href="#2-安装rbenvreadline和openssl">#</a> 2. 安装rbenv、readline和openssl </h3><p>接下来使用上一步安装的Homebrew安装rbenv。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>rbenv
</code></pre></div></div><p>使用ruby-build编译ARM64的Ruby还需要安装对应的ARM64版本readline和openssl。</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install readline
brew install openssl
</code></pre></div></div><p>然后将下述的环境变量添加到<code class="language-plaintext highlighter-rouge">~/.zshrc</code>的末尾。</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/.zshrc</span>
<span class="c"># rbenv</span>
<span class="nb">export </span><span class="nv">RBENV_ROOT</span><span class="o">=</span>/opt/homebrew/opt/rbenv
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$RBENV_ROOT</span>/bin:<span class="nv">$PATH</span>
<span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>rbenv init -<span class="si">)</span><span class="s2">"</span>
<span class="c"># Use native openssl libraries for building</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/opt/homebrew/opt/openssl@1.1/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">export </span><span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-L/opt/homebrew/opt/openssl@1.1/lib"</span>
<span class="nb">export </span><span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">"-I/opt/homebrew/opt/openssl@1.1/include"</span>
<span class="nb">export </span><span class="nv">PKG_CONFIG_PATH</span><span class="o">=</span><span class="s2">"/opt/homebrew/opt/openssl@1.1/lib/pkgconfig"</span>
<span class="nb">export </span><span class="nv">RUBY_CONFIGURE_OPTS</span><span class="o">=</span><span class="s2">"--with-openssl-dir=/opt/homebrew/opt/openssl@1.1"</span>
</code></pre></div></div><p>运行<code class="language-plaintext highlighter-rouge">source ~/.zshrc</code>或者重启Terminal来使环境变量生效。</p><h3 id="3-安装ruby"><a href="#3-安装ruby">#</a> 3. 安装Ruby </h3><p>此时安装2.7.2及以上版本Ruby只需直接运行<code class="language-plaintext highlighter-rouge">rbenv install (version)</code>即可。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Example</span>
rbenv <span class="nb">install </span>2.7.2
rbenv global 2.7.2
rbenv rehash
</code></pre></div></div><p>如果需要安装更低版本的Ruby，则要额外添加一个FLAG。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Example</span>
<span class="nv">RUBY_CFLAGS</span><span class="o">=</span><span class="s2">"-Wno-error=implicit-function-declaration"</span> rbenv <span class="nb">install </span>2.5.3
</code></pre></div></div><h3 id="代理"><a href="#代理">#</a> 代理 </h3><p>如果安装过程出现SSL错误，那么你可能需要代理来下载Ruby源码。将下面的代码添加到<code class="language-plaintext highlighter-rouge">~/.zshrc</code>的末尾，将<code class="language-plaintext highlighter-rouge">ip:port</code>替换成你的代理服务器ip与端口。</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/.zshrc</span>
<span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span><span class="s2">"http://ip:port"</span>
<span class="nb">export </span><span class="nv">HTTP_PROXY</span><span class="o">=</span><span class="k">${</span><span class="nv">http_proxy</span><span class="k">}</span>
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span><span class="k">${</span><span class="nv">http_proxy</span><span class="k">}</span>
<span class="nb">export </span><span class="nv">HTTPS_PROXY</span><span class="o">=</span><span class="k">${</span><span class="nv">http_proxy</span><span class="k">}</span>
</code></pre></div></div><p>同样地，运行<code class="language-plaintext highlighter-rouge">source ~/.zshrc</code>或者重启Terminal来使环境变量生效，然后再重复上一步。</p><h2 id="皆大欢喜"><a href="#皆大欢喜">#</a> 皆大欢喜 </h2><p>此刻运行<code class="language-plaintext highlighter-rouge">ruby -v</code>，就可以发现刚才安装的ruby已经可以运行，开始愉快的<code class="language-plaintext highlighter-rouge">bundle</code>吧！</p><p>开工是不会开工的，只会装好了环境就开始摸鱼这样子。</p><p>参考：<a href="https://github.com/rbenv/ruby-build/issues/1691" target="_blank" rel="nofollow noopener noreferrer">GitHub/ruby-build#1691</a></p></div><ul class="post-pager"><li class="pager--next"><a class="button" href="/2021/02/20/m1-macbook-minecraft/" data-toggle="tooltip" data-placement="top" title="在M1 Macbook上不使用Rosetta优雅地游玩Minecraft+Forge"> NEXT<br><span>在M1 Macbook上不使用Rosetta优雅地游玩Minecraft+Forge</span></a></li><li class="pager--prev"><a class="button" href="/2021/02/14/m1-macbook-experience/" data-toggle="tooltip" data-placement="top" title="M1 MacBook Air轻体验"> PREV<br><span>M1 MacBook Air轻体验</span></a></li></ul><div id="vcomments"></div></div></section><footer class="about condensed"><ul class="social condensed"><li><a target="_blank" rel="noreferrer" href="https://github.com/DotIN13" aria-label="GitHub Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://www.facebook.com/peter.zhang.1466" aria-label="Facebook Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://twitter.com/DotIN13" aria-label="Twitter Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://space.bilibili.com/4471331" aria-label="Bilibili Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="icon-bilibili fa-stack-1x fa-inverse"></i></span></a></li></ul><nav class="navigation condensed"><ul><li><a href="/about">About</a></li><li><a href="/archive">Archive</a></li></ul></nav><section class="about-footer condensed"><div><a href="https://icp.gov.moe" rel="noreferrer" target="_blank">Moe ICP </a><a href="https://icp.gov.moe/?keyword=20201620" target="_blank" rel="noreferrer">20201620</a></div><div><a rel="noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC-BY-SA 4.0</a></div></section></footer></main><script async src="https://www.googletagmanager.com/gtag/js?id=UA-159368053-1"></script><script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-159368053-1');
    </script></body></html>