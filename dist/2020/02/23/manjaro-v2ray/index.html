<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="google-site-verification" content="zrVlHARQzSGPX8n0jKJdP_fCO0AvtLXxoPmYkJh-oXw"/><meta name="description" content="Act local, think global with DotIN13!"><meta name="keywords" content="Linux and V2Ray"><meta name="theme-color" content="#ff94c2"><meta lang="zh"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png?v=2bA3g2vyYK"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png?v=2bA3g2vyYK"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png?v=2bA3g2vyYK"><link rel="mask-icon" href="/assets/img/favicon/safari-pinned-tab.svg?v=2bA3g2vyYK" color="#dc2267"><link rel="shortcut icon" href="/assets/img/favicon/favicon.ico?v=2bA3g2vyYK"><meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/img/favicon/browserconfig.xml?v=2bA3g2vyYK"><meta property="og:title" content="在Linux/Manjaro中使用V2Ray - DOTIN13'S BLOG"><meta property="og:type" content="article"><meta property="og:description" content="Project V 要了解 V2Ray 就必须要知道 Project V，根据官方说法：Project V 是一个工具集合，它可以帮助你打造专属的基础通信网络，Project V 的核心工具称为 V2Ray，其主要负责网络协议和功能的实现，与其它 Project V 通信，V2Ray 可以单独运行，也可以和其它工具配合，以提供简便的操作流程。 相对于shadowsocksr来..."><meta property="article:published_time" content="2020-02-23T13:32:00Z"><meta property="article:author" content="DotIN13"><meta property="article:tag" content="Linux"><meta property="article:tag" content="V2Ray"><meta property="og:image" content="https://www.wannaexpresso.com/assets/img/orange.webp"><meta property="og:url" content="https://www.wannaexpresso.com/2020/02/23/manjaro-v2ray/"><meta property="og:site_name" content="DOTIN13'S BLOG"><link rel="canonical" href="https://www.wannaexpresso.com/2020/02/23/manjaro-v2ray/"><script src="/assets/public/application-bundle.js"></script><link rel="stylesheet" href="/assets/public/application.css"><script src="/assets/public/posts-bundle.js"></script><title>在Linux/Manjaro中使用V2Ray - DOTIN13'S BLOG</title></head><body><main class="container"><section class="about"><div class="about-header"><div class="about-title"><a href="/" id="avatar" data-caption="DotIN13" data-webpack="true" data-path="/assets/img/orange.webp"></a><h2 id="title"><a href="/">DotIN13</a></h2></div><p class="tagline">LACKAWANNA<br>EXPRESSO</p></div><div class="buttons"><a href="/en-us/" class="language-selection button icon-translate" aria-label="Change locale to English."></a><a href="/feed.xml" class="feed button icon-rss_feed" aria-label="RSS Feed"></a><input type="checkbox" class="dark-mode-toggle" aria-label="dark-mode-switch"><a href="#" aria-label="Click to toggle darkmode." class="button"><span class="icon-moon"></span><span class="icon-sun"></span></a><a href="#" id="pwa-install" class="install button icon-install disabled" aria-label="Install as Web Application"><span>Install</span></a></div><ul class="social condensed"><li><a target="_blank" rel="noreferrer" href="https://github.com/DotIN13" aria-label="GitHub Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://www.facebook.com/peter.zhang.1466" aria-label="Facebook Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://twitter.com/DotIN13" aria-label="Twitter Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://space.bilibili.com/4471331" aria-label="Bilibili Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="icon-bilibili fa-stack-1x fa-inverse"></i></span></a></li></ul><nav class="navigation condensed"><ul><li><a href="/about">About</a></li><li><a href="/archive">Archive</a></li></ul></nav><section class="about-footer condensed"><div><a href="https://icp.gov.moe" rel="noreferrer" target="_blank">Moe ICP </a><a href="https://icp.gov.moe/?keyword=20201620" target="_blank" rel="noreferrer">20201620</a></div><div><a rel="noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC-BY-SA 4.0</a></div></section></section><section class="content"><div class="post-container"><a class="post-link" href="/2020/02/23/manjaro-v2ray/"><h2 class="post-title">在Linux/Manjaro中使用V2Ray</h2><h3 class="post-subtitle">Using V2Ray in Manjaro</h3></a><div class="post-meta"><div class="post-categories"><a class="button" href="/archive/?tag=Linux" title="Linux">Linux</a><a class="button" href="/archive/?tag=V2Ray" title="V2Ray">V2Ray</a></div><div class="post-misc"><div class="post-date"><i class="icon-calendar"></i>Feb 23, 2020</div></div></div><div class="post"><h2 id="Project-V"><a href="#Project-V">#</a> Project V </h2><p>要了解 <code>V2Ray</code> 就必须要知道 <a href="https://github.com/v2ray" rel="external nofollow noopener noreferrer" target="_blank">Project V</a>，根据官方说法：<code>Project V</code> 是一个工具集合，它可以帮助你打造专属的基础<strong>通信网络</strong>，<strong>Project V 的核心工具称为 V2Ray</strong>，其主要负责网络协议和功能的实现，与其它 <code>Project V</code> 通信，<code>V2Ray</code> 可以单独运行，也可以和其它工具配合，以提供简便的操作流程。</p><p>相对于<code>shadowsocksr</code>来说，它有以下几个优势：</p><ul><li><strong>多入口多出口</strong>: 一个 <code>V2Ray</code> 进程可并发支持多个入站和出站协议，每个协议可独立工作</li><li><strong>可定制化路由</strong>: 入站流量可按配置由不同的出口发出。轻松实现按区域或按域名分流，以达到最优的网络性能</li><li><strong>多协议支持</strong>: V2Ray 可同时支持多个协议，包括 <code>Socks</code>、<code>HTTP</code>、<code>Shadowsocks</code>、<code>VMess</code> 等</li><li><strong>隐蔽性</strong>: V2Ray 的节点可以伪装成正常的网站（HTTPS），将其流量与正常的网页流量混淆，以避开第三方干扰</li><li><strong>反向代理</strong>: 通用的反向代理支持，可实现内网穿透功能</li><li><strong>多平台支持</strong>: 原生支持所有常见平台，如 Windows、Mac OS、Linux，并已有第三方支持移动平台</li></ul><h2 id="安装V2Ray客户端"><a href="#安装V2Ray客户端">#</a> 安装V2Ray客户端 </h2><p>客户端软件在<a href="https://github.com/v2ray/v2ray-core/releases" rel="external nofollow noopener noreferrer" target="_blank">发布页</a>，根据你需要的系统下载匹配型号的安装包，我这里以我的系统为例子，其他系统请自行参照<a href>官方文档</a>配置。</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>pacman <span class="nt">-S</span> v2ray    <span class="c">#ArchLinux/Manjaro安装v2ray</span></code></pre></figure><p>配置上可以替换<code>/etc/v2ray/config.json</code>文件，参照以下模板自行修改参数即可，注意修改各注释处；或者可以使用<a href="https://intmainreturn0.com/v2ray-config-gen/" rel="external nofollow noopener noreferrer" target="_blank">配置生成器</a>。</p><details><summary>config.json示例</summary><figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"inbounds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1080</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">监听端口</span><span class="w">
      </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"socks"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">入口协议为</span><span class="w"> </span><span class="err">SOCKS</span><span class="w"> </span><span class="mi">5</span><span class="w">
      </span><span class="nl">"sniffing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"destOverride"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"http"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tls"</span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"auth"</span><span class="p">:</span><span class="w"> </span><span class="s2">"noauth"</span><span class="w">  </span><span class="err">//socks的认证设置，noauth</span><span class="w"> </span><span class="err">代表不认证，由于</span><span class="w"> </span><span class="err">socks</span><span class="w"> </span><span class="err">通常在客户端使用，所以这里不认证</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"outbounds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vmess"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">出口协议</span><span class="w">
      </span><span class="nl">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"vnext"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"serveraddr.com"</span><span class="p">,</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">服务器地址，请修改为你自己的服务器</span><span class="w"> </span><span class="err">IP</span><span class="w"> </span><span class="err">或域名</span><span class="w">
            </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">16823</span><span class="p">,</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">服务器端口</span><span class="w">
            </span><span class="nl">"users"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b831381d-6324-4d53-ad4f-8cda48b30811"</span><span class="p">,</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">用户</span><span class="w"> </span><span class="err">ID，必须与服务器端配置相同</span><span class="w">
                </span><span class="nl">"alterId"</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">此处的值也应当与服务器相同</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
    </span></code></pre></figure></details><p><code>V2Ray</code>支持配置多个服务器，那么多个服务器配置的时候，它其实是轮询访问的，也就是说第一个数据包走第一个服务器，第二个数据包走第二个服务器，而不是我们一般认为的第一个服务器被墙了就自动切换到第二个服务器，然后继续传输。 </p>p>路由规则参照 <a href="https://github.com/v2ray/domain-list-community" rel="external nofollow noopener noreferrer" target="_blank">domain-list-community</a> 域名列表，如果该项目中有一整套 <code>google</code> 顶级域名及其子域名，则用 <code>geosite</code> 写成 <code>geosite:google</code> ，如果是普通网站，则使用 <code>domain</code> 写成 <code>domain:google.com</code></p></details><p>使用<code>v2ray</code>自带了一个检查工具<code>v2ray -test</code>检查<code>json</code>文件</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">v2ray <span class="nt">-test</span> <span class="nt">-config</span> /etc/v2ray/config.json  <span class="c">#检查json</span>
V2Ray 4.18.0 <span class="o">(</span>Po<span class="o">)</span> 20190228
A unified platform <span class="k">for </span>anti-censorship.
Configuration OK.</code></pre></figure><p>显示<code>OK</code>就表示没问题了，可以开启本机的开机自启服务</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">systemctl <span class="nb">enable </span>v2ray  <span class="c">#开机自启v2ray</span>
systemctl start v2ray   <span class="c">#启动v2ray</span></code></pre></figure><h2 id="配置Socks代理"><a href="#配置Socks代理">#</a> 配置Socks代理 </h2><p>打开系统设置，进入网络设置，配置如下图：</p><p><div class="post-img"><a href="/assets/img/in-post/post-v2ray/v2ray-manual-socks.png" data-fancybox="gallery" data-caption="System Manual Proxy" data-path="post-v2ray/v2ray-manual-socks.png" data-webpack=true></a><em>System Manual Proxy</em></div></p><p>如果仅需要浏览器代理，可以下载<code>SwitchyOmega</code>浏览器插件，最简配置如下：</p><p><div class="post-img"><a href="/assets/img/in-post/post-v2ray/switchyomega.png" data-fancybox="gallery" data-caption="SwitchyOmega Settings" data-path="post-v2ray/switchyomega.png" data-webpack=true></a><em>SwitchyOmega Settings</em></div></p><h2 id="配置shell代理"><a href="#配置shell代理">#</a> 配置shell代理 </h2><p>为了解决终端下载被墙服务器的安装包失败的问题，可以考虑代理终端。</p><h3 id="临时代理"><a href="#临时代理">#</a> 临时代理 </h3> 只需要http代理则输入命令<code>export http_proxy=http://proxyAddress:port</code>； 全部协议代理则输入命令<code>export ALL_PROXY=http://proxyAddress:port</code>。 临时代理仅对当前环境有效，重启即失效。 <h3 id="长期代理"><a href="#长期代理">#</a> 长期代理 </h3><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>gedit ~/.bashrc    <span class="c">#编辑.bashrc文件</span></code></pre></figure><p>在最后追加以下配置。</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span><span class="s2">"http://localhost:port"</span>
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span><span class="s2">"http://localhost:port"</span></code></pre></figure><p><code>source ~/.bashrc</code>或者重启终端后生效</p><h2 id="配置PAC"><a href="#配置PAC">#</a> 配置PAC </h2><h3 id="生成PAC"><a href="#生成PAC">#</a> 生成PAC </h3><p><code>PAC</code>代理需要生成一个<code>.pac</code>的文件，首先本机安装<code>pip</code>工具</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>pacman <span class="nt">-S</span> python-pip       <span class="c">#安装pip</span>
pip <span class="nt">-V</span>      <span class="c">#查看pip版本</span>
<span class="c">#-------------------------输出----------------------------</span>
pip 19.0.3 from /usr/lib/python3.7/site-packages/pip <span class="o">(</span>python 3.7<span class="o">)</span></code></pre></figure><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>pip <span class="nb">install </span>genpac     <span class="c">#使用pip安装genpac，需要root权限</span>
<span class="c">#-------------------------输出----------------------------</span>
Collecting genpac
  Downloading https://files.pythonhosted.org/packages/48/fb/b8f9cce57c4ea856e7dd1f9fb917df2896d7e62d43c50ed1af2e50a4e57d/genpac-2.1.0.tar.gz <span class="o">(</span>102kB<span class="o">)</span>
     |████████████████████████████████| 112kB 111kB/s 
Installing collected packages: genpac
  Running setup.py <span class="nb">install </span><span class="k">for </span>genpac ... <span class="k">done
</span>Successfully installed genpac-2.1.0</code></pre></figure><p>最后执行以下命令，会生成一个auto.pac文件，无输出结果表示执行成功</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">genpac <span class="nt">--format</span><span class="o">=</span>pac <span class="nt">-o</span> auto.pac <span class="nt">--pac-proxy</span><span class="o">=</span><span class="s2">"SOCKS5 127.0.0.1:1080"</span></code></pre></figure><h3 id="Firefox PAC代理设置"><a href="#Firefox PAC代理设置">#</a> Firefox PAC代理设置 </h3><p>PAC文件的绝对路径为<code>file:///etc/v2ray/auto.pac</code>，如下图</p><p><div class="post-img"><a href="/assets/img/in-post/post-v2ray/firefox-pac.png" data-fancybox="gallery" data-caption="Firefox PAC Manual Proxy" data-path="post-v2ray/firefox-pac.png" data-webpack=true></a><em>Firefox PAC Manual Proxy</em></div></p><h3 id="系统PAC代理设置"><a href="#系统PAC代理设置">#</a> 系统PAC代理设置 </h3><p>以<code>gnome</code>桌面为例，PAC文件的绝对路径为<code>file:///etc/v2ray/auto.pac</code>； </p><p><div class="post-img"><a href="/assets/img/in-post/post-v2ray/v2ray-auto-pac.png" data-fancybox="gallery" data-caption="PAC Automatic Proxy" data-path="post-v2ray/v2ray-auto-pac.png" data-webpack=true></a><em>PAC Automatic Proxy</em></div></p><p>全局代理也可以通过以下命令来设置:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">gsettings <span class="nb">set </span>org.gnome.system.proxy autoconfig-url file:///etc/v2ray/auto.pac
gsettings <span class="nb">set </span>org.gnome.system.proxy mode <span class="s1">'auto'</span>

gsettings <span class="nb">set </span>org.gnome.system.proxy.socks host <span class="s1">'127.0.0.1'</span>
gsettings <span class="nb">set </span>org.gnome.system.proxy.socks port 1088</code></pre></figure><p>转引自<a href="https://www.teaper.dev/2019/06/02/v2ray/">https://www.teaper.dev/2019/06/02/v2ray/</a>，有修改。</p></div><ul class="post-pager"><li class="pager--next"><a class="button" href="/2020/02/23/linux-auto-mount/" data-toggle="tooltip" data-placement="top" title="Linux开机自动挂载分区"> NEXT<br><span>Linux开机自动挂载分区</span></a></li><li class="pager--prev"><a class="button" href="/2020/02/23/manjaro-fcitx-rime/" data-toggle="tooltip" data-placement="top" title="在Linux/Manjaro中使用Fcitx+Rime"> PREV<br><span>在Linux/Manjaro中使用Fcitx+Rime</span></a></li></ul><div id="vcomments"></div></div></section><footer class="about condensed"><ul class="social condensed"><li><a target="_blank" rel="noreferrer" href="https://github.com/DotIN13" aria-label="GitHub Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://www.facebook.com/peter.zhang.1466" aria-label="Facebook Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://twitter.com/DotIN13" aria-label="Twitter Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://space.bilibili.com/4471331" aria-label="Bilibili Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="icon-bilibili fa-stack-1x fa-inverse"></i></span></a></li></ul><nav class="navigation condensed"><ul><li><a href="/about">About</a></li><li><a href="/archive">Archive</a></li></ul></nav><section class="about-footer condensed"><div><a href="https://icp.gov.moe" rel="noreferrer" target="_blank">Moe ICP </a><a href="https://icp.gov.moe/?keyword=20201620" target="_blank" rel="noreferrer">20201620</a></div><div><a rel="noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC-BY-SA 4.0</a></div></section></footer></main><script async src="https://www.googletagmanager.com/gtag/js?id=UA-159368053-1"></script><script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-159368053-1');
    </script></body></html>