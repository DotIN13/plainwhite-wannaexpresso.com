<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="google-site-verification" content="zrVlHARQzSGPX8n0jKJdP_fCO0AvtLXxoPmYkJh-oXw"/><meta name="description" content="Act local, think global with DotIN13!"><meta name="keywords" content="Raspberry Pi, Aria2, and Linux"><meta name="theme-color" content="#ff94c2"><meta lang="zh"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png?v=2bA3g2vyYK"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png?v=2bA3g2vyYK"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png?v=2bA3g2vyYK"><link rel="mask-icon" href="/assets/img/favicon/safari-pinned-tab.svg?v=2bA3g2vyYK" color="#dc2267"><link rel="shortcut icon" href="/assets/img/favicon/favicon.ico?v=2bA3g2vyYK"><meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/img/favicon/browserconfig.xml?v=2bA3g2vyYK"><meta property="og:title" content="用RaspberryPi搭建Aria2+Caddy2下载站 - DOTIN13'S BLOG"><meta property="og:type" content="article"><meta property="og:description" content="Aria2 我的Raspi-4B安装了官方提供的Rasbian，刷入过程非常简单，下载解压dd三步搞定，可以参考Pi官网。Aria2下载器相信大家也都不陌生，直接使用apt安装即可（记得换源）。 sudo apt update &amp;&amp; sudo apt install aria2 安装完毕之后依照惯例创建aria2的各项文件。 由于需要通过SFTP、SMB来管理下载的..."><meta property="article:published_time" content="2020-04-21T00:00:00Z"><meta property="article:author" content="DotIN13"><meta property="article:tag" content="Raspberry Pi"><meta property="article:tag" content="Aria2"><meta property="article:tag" content="Linux"><meta property="og:image" content="https://www.wannaexpresso.com/assets/img/orange.webp"><meta property="og:url" content="https://www.wannaexpresso.com/2020/04/21/aria-pi/"><meta property="og:site_name" content="DOTIN13'S BLOG"><link rel="canonical" href="https://www.wannaexpresso.com/2020/04/21/aria-pi/"><script src="/assets/public/application-bundle.js"></script><link rel="stylesheet" href="/assets/public/application.css"><script src="/assets/public/posts-bundle.js"></script><title>用RaspberryPi搭建Aria2+Caddy2下载站 - DOTIN13'S BLOG</title></head><body><main class="container"><section class="about"><div class="about-header"><div class="about-title"><a href="/" id="avatar" data-caption="DotIN13" data-webpack="true" data-path="/assets/img/orange.webp"></a><h2 id="title"><a href="/">DotIN13</a></h2></div><p class="tagline">LACKAWANNA<br>EXPRESSO</p></div><div class="buttons"><a href="/en-us/" class="language-selection button icon-translate" aria-label="Change locale to English."></a><a href="/feed.xml" class="feed button icon-rss_feed" aria-label="RSS Feed"></a><input type="checkbox" class="dark-mode-toggle" aria-label="dark-mode-switch"><a href="#" aria-label="Click to toggle darkmode." class="button"><span class="icon-moon"></span><span class="icon-sun"></span></a><a href="#" id="pwa-install" class="install button icon-install disabled" aria-label="Install as Web Application"><span>Install</span></a></div><ul class="social condensed"><li><a target="_blank" rel="noreferrer" href="https://github.com/DotIN13" aria-label="GitHub Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://www.facebook.com/peter.zhang.1466" aria-label="Facebook Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://twitter.com/DotIN13" aria-label="Twitter Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://space.bilibili.com/4471331" aria-label="Bilibili Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="icon-bilibili fa-stack-1x fa-inverse"></i></span></a></li></ul><nav class="navigation condensed"><ul><li><a href="/about">About</a></li><li><a href="/archive">Archive</a></li></ul></nav><section class="about-footer condensed"><div><a href="https://icp.gov.moe" rel="noreferrer" target="_blank">Moe ICP </a><a href="https://icp.gov.moe/?keyword=20201620" target="_blank" rel="noreferrer">20201620</a></div><div><a rel="noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC-BY-SA 4.0</a></div></section></section><section class="content"><div class="post-container"><a class="post-link" href="/2020/04/21/aria-pi/"><h2 class="post-title">用RaspberryPi搭建Aria2+Caddy2下载站</h2><h3 class="post-subtitle">Building Aria2 + Caddy 2 Download Station with RaspberryPi</h3></a><div class="post-meta"><div class="post-categories"><a class="button" href="/archive/?tag=Raspberry+Pi" title="Raspberry Pi">Raspberry Pi</a><a class="button" href="/archive/?tag=Aria2" title="Aria2">Aria2</a><a class="button" href="/archive/?tag=Linux" title="Linux">Linux</a></div><div class="post-misc"><div class="post-date"><i class="icon-calendar"></i>Apr 21, 2020</div></div></div><div class="post"><h2 id="aria2"><a href="#aria2">#</a> Aria2 </h2><p>我的Raspi-4B安装了官方提供的Rasbian，刷入过程非常简单，下载解压dd三步搞定，可以参考<a href="https://www.raspberrypi.org/documentation/installation/installing-images/linux.md" target="_blank" rel="nofollow noopener noreferrer">Pi官网</a>。Aria2下载器相信大家也都不陌生，直接使用apt安装即可（记得<a href="https://mirror.tuna.tsinghua.edu.cn/help/raspbian/" target="_blank" rel="nofollow noopener noreferrer">换源</a>）。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt <span class="nb">install </span>aria2
</code></pre></div></div><p>安装完毕之后依照惯例创建aria2的各项文件。</p><p>由于需要通过SFTP、SMB来管理下载的文件，我们设置aria2以低权限用户aria运行。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>groupadd <span class="nt">-r</span> aria <span class="c"># 添加用户组aria</span>
useradd <span class="nt">-r</span> <span class="nt">-g</span> aria <span class="nt">-s</span> /usr/sbin/nologin <span class="nt">-c</span> <span class="s2">"Aria 2"</span> aria <span class="c"># 添加用户aria</span>

<span class="nb">sudo mkdir</span> <span class="nt">-p</span> /home/aria/aria2 <span class="c"># 创建工作目录</span>
<span class="nb">touch</span> /home/aria/aria2/aria2.session <span class="c"># 创建aria2进度文件</span>
<span class="nb">touch</span> /home/aria/aria2/aria2.log <span class="c"># 创建aria2日志文件</span>
<span class="nb">touch</span> /home/aria/aria2/aria2.config <span class="c"># 创建aria2配置文件</span>

<span class="nb">chown </span>aria:aria /home/aria/<span class="k">*</span> <span class="c"># 将工作目录下的文件移交给aria用户</span>
</code></pre></div></div><p>然后<code class="language-plaintext highlighter-rouge">nano /home/aria/aria2/aria2.config</code>编辑配置文件。</p><details><summary>配置示例</summary><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># 下载地址</span>
<span class="s">dir=/home/pi/Downloads</span>
<span class="c1"># 启用磁盘缓存, 0为禁用缓存, 需1.16以上版本, 默认:16M</span>
<span class="c1">#disk-cache=32M</span>
<span class="c1"># 文件预分配方式, 能有效降低磁盘碎片, 默认:prealloc</span>
<span class="c1"># 预分配所需时间: none &lt; falloc ? trunc &lt; prealloc</span>
<span class="c1"># falloc和trunc则需要文件系统和内核支持</span>
<span class="c1"># NTFS建议使用falloc, EXT3/4建议trunc, MAC 下需要注释此项</span>
<span class="s">file-allocation=trunc</span>

<span class="s">continue=true</span>

<span class="c1">## 下载连接相关 ##</span>

<span class="c1"># 最大同时下载任务数, 运行时可修改, 默认:5</span>
<span class="s">max-concurrent-downloads=5</span>
<span class="c1"># 同一服务器连接数, 添加时可指定, 默认:1</span>
<span class="s">max-connection-per-server=16</span>
<span class="c1"># 最小文件分片大小, 添加时可指定, 取值范围1M -1024M, 默认:20M</span>
<span class="c1"># 假定size=10M, 文件为20MiB 则使用两个来源下载; 文件为15MiB 则使用一个来源下载</span>
<span class="s">min-split-size=10M</span>
<span class="c1"># 单个任务最大线程数, 添加时可指定, 默认:5</span>
<span class="s">split=16</span>
<span class="c1"># 整体下载速度限制, 运行时可修改, 默认:0</span>
<span class="c1">#max-overall-download-limit=0</span>
<span class="c1"># 单个任务下载速度限制, 默认:0</span>
<span class="c1">#max-download-limit=0</span>
<span class="c1"># 整体上传速度限制, 运行时可修改, 默认:0</span>
<span class="s">max-overall-upload-limit=10K</span>
<span class="c1"># 单个任务上传速度限制, 默认:0</span>
<span class="s">max-upload-limit=20</span>
<span class="c1"># 禁用IPv6, 默认:false</span>
<span class="s">disable-ipv6=false</span>

<span class="c1">## 进度保存相关 ##</span>

<span class="c1"># 从会话文件中读取下载任务</span>
<span class="s">input-file=/home/aria/aria2/aria2.session</span>
<span class="c1"># 在Aria2退出时保存`错误/未完成`的下载任务到会话文件</span>
<span class="s">save-session=/home/aria/aria2/aria2.session</span>
<span class="c1"># 定时保存会话, 0为退出时才保存, 需1.16.1以上版本, 默认:0</span>
<span class="s">save-session-interval=60</span>

<span class="c1">## RPC相关设置 ##</span>

<span class="c1"># 启用RPC, 默认:false</span>
<span class="s">enable-rpc=true</span>
<span class="c1"># 允许所有来源, 默认:false</span>
<span class="s">rpc-allow-origin-all=true</span>
<span class="c1"># 允许非外部访问, 默认:false</span>
<span class="s">rpc-listen-all=true</span>
<span class="c1"># 在 RPC 服务中启用 SSL/TLS 加密时的证书文件(.pem/.crt)</span>
<span class="c1">#rpc-certificate=/etc/letsencrypt/live/aria.wannaexpresso.com/fullchain.pem</span>
<span class="c1"># 在 RPC 服务中启用 SSL/TLS 加密时的私钥文件(.key)</span>
<span class="c1">#rpc-private-key=/etc/letsencrypt/live/aria.wannaexpresso.com/privkey.pem</span>
<span class="c1"># 事件轮询方式, 取值:[epoll, kqueue, port, poll, select], 不同系统默认值不同</span>
<span class="c1">#event-poll=select</span>
<span class="c1"># RPC监听端口, 端口被占用时可以修改, 默认:6800</span>
<span class="c1">#rpc-listen-port=6800</span>
<span class="c1"># 设置的RPC授权令牌, v1.18.4新增功能, 取代 --rpc-user 和 --rpc-passwd 选项</span>
<span class="c1">#rpc-secret=secret</span>
<span class="c1"># 设置的RPC访问用户名, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span>
<span class="c1">#rpc-user=&lt;USER&gt;</span>
<span class="c1"># 设置的RPC访问密码, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span>
<span class="c1">#rpc-passwd=&lt;PASSWD&gt;</span>

<span class="c1">## BT/PT下载相关 ##</span>

<span class="c1"># 当下载的是一个种子(以.torrent结尾)时, 自动开始BT任务, 默认:true</span>
<span class="c1">#follow-torrent=true</span>
<span class="c1"># BT监听端口, 当端口被屏蔽时使用, 默认:6881-6999</span>
<span class="s">listen-port=51413</span>
<span class="c1"># 单个种子最大连接数, 默认:55</span>
<span class="c1">#bt-max-peers=55</span>
<span class="c1"># 打开DHT功能, PT需要禁用, 默认:true</span>
<span class="c1">#enable-dht=false</span>
<span class="c1"># 打开IPv6 DHT功能, PT需要禁用</span>
<span class="s">enable-dht6=true</span>
<span class="c1"># DHT网络监听端口, 默认:6881-6999</span>
<span class="c1">#dht-listen-port=6881-6999</span>
<span class="c1"># 本地节点查找, PT需要禁用, 默认:false</span>
<span class="c1">#bt-enable-lpd=false</span>
<span class="c1"># 种子交换, PT需要禁用, 默认:true</span>
<span class="s">enable-peer-exchange=true</span>
<span class="c1"># 每个种子限速, 对少种的PT很有用, 默认:50K</span>
<span class="c1">#bt-request-peer-speed-limit=50K</span>
<span class="c1"># 客户端伪装, PT需要</span>
<span class="c1">#peer-id-prefix=-TR2770-</span>
<span class="c1">#user-agent=Transmission/2.77</span>
<span class="c1"># 当种子的分享率达到这个数时, 自动停止做种, 0为一直做种, 默认:1.0</span>
<span class="c1">#seed-ratio=0</span>
<span class="c1"># 强制保存会话, 话即使任务已经完成, 默认:false</span>
<span class="c1"># 较新的版本开启后会在任务完成后依然保留.aria2文件</span>
<span class="c1">#force-save=false</span>
<span class="c1"># BT校验相关, 默认:true</span>
<span class="c1">#bt-hash-check-seed=true</span>
<span class="c1"># 继续之前的BT任务时, 无需再次校验, 默认:false</span>
<span class="s">bt-seed-unverified=true</span>
<span class="c1"># 保存磁力链接元数据为种子文件(.torrent文件), 默认:false</span>
<span class="s">bt-save-metadata=true</span>
<span class="s">bt-tracker=udp://62.138.0.158:6969/announce,udp://87.233.192.220:6969/announce,udp://111.6.78.96:6969/announce,udp://90.179.64.91:1337/announce,udp://51.15.4.13:1337/announce,udp://151.80.120.113:2710/announce,udp://191.96.249.23:6969/announce,udp://35.187.36.248:1337/announce,udp://123.249.16.65:2710/announce,udp://210.244.71.25:6969/announce,udp://78.142.19.42:1337/announce,udp://173.254.219.72:6969/announce,udp://51.15.76.199:6969/announce,udp://51.15.40.114:80/announce,udp://91.212.150.191:3418/announce,udp://103.224.212.222:6969/announce,udp://5.79.83.194:6969/announce,udp://92.241.171.245:6969/announce,udp://5.79.209.57:6969/announce,udp://82.118.242.198:1337/announce</span></code></pre></figure></details><p>然后建立自启动<code class="language-plaintext highlighter-rouge">sudo touch /etc/systemd/system/aria2.service</code></p><blockquote><p>2021/02/21更新：修改aria2c二进制文件权限的方法似乎不能保证下载的文件可以由其他用户修改。我发现可以在service文件中使用<code class="language-plaintext highlighter-rouge">UMask=</code>来确保今后下载文件的权限为777。</p></blockquote><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /etc/systemd/system/aria2.service</span>
<span class="pi">[</span><span class="nv">Unit</span><span class="pi">]</span>
<span class="s">Description=Aria2 Service</span>
<span class="s">After=network.target</span>

<span class="pi">[</span><span class="nv">Service</span><span class="pi">]</span>
<span class="s">User=aria</span>
<span class="s">Group=aria</span>
<span class="s">UMask=0000</span>
<span class="s">ExecStart=/usr/bin/aria2c --conf-path=/home/pi/.config/aria2/aria2.config</span>
<span class="s">ExecStop=/bin/kill $MAINPID</span>

<span class="pi">[</span><span class="nv">Install</span><span class="pi">]</span>
<span class="s">WantedBy=multi-user.target</span>
</code></pre></div></div><p>利用下面的systemctl命令来开启aria2的自启动：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl daemon-reload <span class="c"># 重新加载修改过的service文件</span>
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>aria2 <span class="c"># 开启自启动</span>
<span class="nb">sudo </span>systemctl start aria2 <span class="c"># 启动服务</span>
<span class="nb">sudo </span>systemctl status aria2 <span class="c"># 查看日志</span>
</code></pre></div></div><blockquote><p>Notes: 查看日志，如果出现问题，可以利用<code class="language-plaintext highlighter-rouge">sudo -u aria aria2c /home/aria/aria2/aria2.config</code>来进行调试。</p></blockquote><p>Aria2到这里就配置好了。</p><h2 id="ariang"><a href="#ariang">#</a> AriaNG </h2><p>到<a href="https://github.com/mayswind/AriaNg/releases" target="_blank" rel="nofollow noopener noreferrer">GitHub</a>下载Aria2的前端AriaNG。这时在图形界面的计算机上，可以打开刚才下载的index.html，尝试连接<code class="language-plaintext highlighter-rouge">127.0.0.1:6800/jsonrpc</code>，来检查Aria2是否配置正确。</p><p>如果你想直接用树莓派架设管理界面，那么就要用到AriaNG一类的封装配合HTTP服务器。但我不建议这么做，因为运营商封禁HTTP/HTTPS端口导致配置尤其复杂，也导致难以获得域名证书，难以使用安全的HTTPS连接到树莓派；此外，无备案架设HTTP服务器也有被运营商关闭端口的风险。</p><h2 id="caddy-2"><a href="#caddy-2">#</a> Caddy 2 </h2><p>首先使用<code class="language-plaintext highlighter-rouge">wget</code>将AriaNG下载到树莓派。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/mayswind/AriaNg/releases/download/1.2.1/AriaNg-1.2.1-AllInOne.zip <span class="c"># 下载AriaNG的示例</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>unzip
unzip AriaNg-1.2.1-AllInOne.zip <span class="c"># 解压</span>
</code></pre></div></div><p>以下将使用<code class="language-plaintext highlighter-rouge">/path/containing/arianghtml</code>代替解压的目录。</p><p>我们要用到的HTTP服务器Caddy已经更新到了2.0（撒花），因此这里我们也与时俱进一把。</p><h3 id="依照官方指南安装caddy"><a href="#依照官方指南安装caddy">#</a> 依照<a href="https://caddyserver.com/docs/install" target="_blank" rel="nofollow noopener noreferrer">官方指南</a>安装Caddy </h3><ol><li><p>到<a href="https://github.com/caddyserver/caddy/releases" target="_blank" rel="nofollow noopener noreferrer">GitHub</a>下载<code class="language-plaintext highlighter-rouge">*linux_armv7*</code>版本的caddy，解压后利用<code class="language-plaintext highlighter-rouge">sudo mv caddy /usr/bin</code>复制到/usr/bin。</p></li><li><p>用<code class="language-plaintext highlighter-rouge">caddy version</code>来检验安装是否成功。</p></li><li><p>添加用户组<code class="language-plaintext highlighter-rouge">caddy</code>。</p></li></ol><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>groupadd <span class="nt">--system</span> caddy
</code></pre></div></div><ol start="4"><li>创建一个名为caddy的用户，并为他指派工作目录。</li></ol><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>useradd <span class="nt">--system</span> <span class="se">\</span>
	<span class="nt">--gid</span> caddy <span class="se">\</span>
	<span class="nt">--create-home</span> <span class="se">\</span>
	<span class="nt">--home-dir</span> /var/lib/caddy <span class="se">\</span>
	<span class="nt">--shell</span> /usr/sbin/nologin <span class="se">\</span>
	<span class="nt">--comment</span> <span class="s2">"Caddy web server"</span> <span class="se">\</span>
	caddy
</code></pre></div></div><ol start="5"><li>下载<a href="https://github.com/caddyserver/dist/blob/master/init/caddy.service" target="_blank" rel="nofollow noopener noreferrer">caddy.service</a>文件，利用<code class="language-plaintext highlighter-rouge">sudo mv caddy.service /etc/systemd/system/caddy.service</code>将其复制到目标目录。</li></ol><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 啊哈你获得了一个三连！</span>
<span class="nb">sudo </span>systemctl daemon-reload
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>caddy
<span class="nb">sudo </span>systemctl start caddy
</code></pre></div></div><p>用以上的命令在后台常驻caddy。 其他一些有用的命令如下：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status caddy <span class="c"># 查看运行状态</span>
journalctl <span class="nt">-u</span> caddy <span class="c"># 查看全部日志</span>
<span class="nb">sudo </span>systemctl reload caddy <span class="c"># 重新加载Caddy配置文件</span>
<span class="nb">sudo </span>systemctl stop caddy <span class="c"># 关停</span>
</code></pre></div></div><ol start="6"><li>Caddy 2的运行可以通过Caddyfile配置文件或者API控制，我们这里使用比较简单的Caddyfile。官方给出的后台服务caddy.service调用的是<code class="language-plaintext highlighter-rouge">/etc/caddy/</code>下的Caddyfile。</li></ol><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo touch</span> /etc/caddy/Caddyfile
<span class="nb">sudo </span>nano /etc/caddy/Caddyfile
</code></pre></div></div><p>编辑内容为如下：</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Your.Raspberry.Pi.IP{
  root * /path/containing/arianghtml
  file_server
  reverse_proxy /jsonrpc 127.0.0.1:6800
}
</code></pre></div></div><ul><li><code class="language-plaintext highlighter-rouge">Your.Raspberry.Pi.IP</code>就是你的树莓派在家庭网络中的地址。</li><li><code class="language-plaintext highlighter-rouge">/path/containing/arianghtml</code>就是你刚才解压index.html的目录。</li><li><code class="language-plaintext highlighter-rouge">reverse_proxy /jsonrpc 127.0.0.1:6800</code>表示将aria2的端口反向代理到443端口，可以解决aria2没有证书，无法在https页面上使用的问题。</li></ul><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl reload caddy <span class="c"># 重新加载Caddyfile</span>
</code></pre></div></div><p>此时打开浏览器访问<code class="language-plaintext highlighter-rouge">https://Your.Raspberry.Pi.IP</code>，在<code class="language-plaintext highlighter-rouge">AriaNG设置</code>填入<code class="language-plaintext highlighter-rouge">Your.Raspberry.Pi.IP:443/jsonrpc</code>，就可以连接你的树莓派下载站了。</p><h2 id="外网访问"><a href="#外网访问">#</a> 外网访问 </h2><p>外网访问我只在此简单叙述，需要实现请另外查阅其他资料。</p><h3 id="解决方案一公网ipddns域名"><a href="#解决方案一公网ipddns域名">#</a> 解决方案一：公网IP+DDNS+域名 </h3><p>在你的路由器上配置DDNS，将动态的IP通过DNS服务转化为静态的地址。由于运营商会封闭家用网路的443和80端口，因此你需要将AriaNG架设在其他端口。</p><p>这里会遇到的问题是Caddy自动获取证书至少需要443端口畅通，这是做不到的，因此只能利用DNS Challenge配合Certbot<a href="https://www.bjornjohansen.com/wildcard-certificate-letsencrypt-cloudflare" target="_blank" rel="nofollow noopener noreferrer">手动获取证书</a>。</p><p>需要提醒的是如果用Cloudflare，Raspberry Pi的Certbot插件还不支持Zone Key，只能使用CF的Global Key。</p><p>获取证书之后可以这样配置Caddyfile</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Your.Raspberry.Pi.IP, Your.Domain:OtherPorts{
  tls /path/to/fullchain.pem /path/to/privkey.pem
  root * /path/containing/arianghtml
  file_server
  reverse_proxy /jsonrpc 127.0.0.1:6800
}
</code></pre></div></div><h3 id="解决方案二-zerotier"><a href="#解决方案二-zerotier">#</a> 解决方案二： ZeroTier </h3><p>利用<a href="https://www.zerotier.com/" target="_blank" rel="nofollow noopener noreferrer">ZeroTier</a>组建虚拟局域网，便可以用Zerotier提供的IP地址访问树莓派，也可以在路由器安装，配置好后可以用家庭网络的IP访问树莓派，配置的过程非常容易。</p><h3 id="其他解决方案"><a href="#其他解决方案">#</a> 其他解决方案 </h3><p>其他方案还有FRP、花生壳等，感兴趣可以自行研究。</p><h2 id="总结"><a href="#总结">#</a> 总结 </h2><p>事实上现在也并不怎么下载东西，折腾仅仅是为了折腾。不过折腾也能乐在其中……</p></div><ul class="post-pager"><li class="pager--next"><a class="button" href="/2020/04/26/wod-reverse-proxy/" data-toggle="tooltip" data-placement="top" title="用Caddy2反向代理地下城世界"> NEXT<br><span>用Caddy2反向代理地下城世界</span></a></li><li class="pager--prev"><a class="button" href="/2020/04/20/epon-modem-bridge/" data-toggle="tooltip" data-placement="top" title="将电信EPON光猫切换到桥接模式"> PREV<br><span>将电信EPON光猫切换到桥接模式</span></a></li></ul><div id="vcomments"></div></div></section><footer class="about condensed"><ul class="social condensed"><li><a target="_blank" rel="noreferrer" href="https://github.com/DotIN13" aria-label="GitHub Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://www.facebook.com/peter.zhang.1466" aria-label="Facebook Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://twitter.com/DotIN13" aria-label="Twitter Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://space.bilibili.com/4471331" aria-label="Bilibili Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="icon-bilibili fa-stack-1x fa-inverse"></i></span></a></li></ul><nav class="navigation condensed"><ul><li><a href="/about">About</a></li><li><a href="/archive">Archive</a></li></ul></nav><section class="about-footer condensed"><div><a href="https://icp.gov.moe" rel="noreferrer" target="_blank">Moe ICP </a><a href="https://icp.gov.moe/?keyword=20201620" target="_blank" rel="noreferrer">20201620</a></div><div><a rel="noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC-BY-SA 4.0</a></div></section></footer></main><script async src="https://www.googletagmanager.com/gtag/js?id=UA-159368053-1"></script><script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-159368053-1');
    </script></body></html>