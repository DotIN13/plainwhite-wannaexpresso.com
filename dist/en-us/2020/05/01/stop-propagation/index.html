<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="google-site-verification" content="zrVlHARQzSGPX8n0jKJdP_fCO0AvtLXxoPmYkJh-oXw"/><meta name="description" content="Act local, think global with DotIN13!"><meta name="keywords" content="JavaScript and Blog"><meta name="theme-color" content="#ff94c2"><meta lang="en"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicon/apple-touch-icon.png?v=2bA3g2vyYK"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon/favicon-32x32.png?v=2bA3g2vyYK"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon/favicon-16x16.png?v=2bA3g2vyYK"><link rel="mask-icon" href="/assets/img/favicon/safari-pinned-tab.svg?v=2bA3g2vyYK" color="#dc2267"><link rel="shortcut icon" href="/assets/img/favicon/favicon.ico?v=2bA3g2vyYK"><meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/img/favicon/browserconfig.xml?v=2bA3g2vyYK"><meta property="og:title" content="Onclick Not Working after Switching Pages? stopPropagation Saves the Day! - DOTIN13'S BLOG"><meta property="og:type" content="article"><meta property="og:description" content="Plainwhite Theme After surfing the NET for a while, I found that there were really a lot of people using Hux Blog Jekyll theme, which was a solid proof the theme stands out both visually and pragm..."><meta property="article:published_time" content="2020-05-01T00:00:00Z"><meta property="article:author" content="DotIN13"><meta property="article:tag" content="JavaScript"><meta property="article:tag" content="Blog"><meta property="og:image" content="https://www.wannaexpresso.com/assets/img/orange.webp"><meta property="og:url" content="https://www.wannaexpresso.com/en-us/2020/05/01/stop-propagation/"><meta property="og:site_name" content="DOTIN13'S BLOG"><link rel="canonical" href="https://www.wannaexpresso.com/en-us/2020/05/01/stop-propagation/"><script src="/assets/public/application-bundle.js"></script><link rel="stylesheet" href="/assets/public/application.css"><script src="/assets/public/posts-bundle.js"></script><title>Onclick Not Working after Switching Pages? stopPropagation Saves the Day! - DOTIN13'S BLOG</title></head><body><main class="container"><section class="about"><div class="about-header"><div class="about-title"><a href="/en-us/" id="avatar" data-caption="DotIN13" data-webpack="true" data-path="/assets/img/orange.webp"></a><h2 id="title"><a href="/en-us/">DotIN13</a></h2></div><p class="tagline">LACKAWANNA<br>EXPRESSO</p></div><div class="buttons"><a href="/" class="language-selection button icon-translate-off" aria-label="Change locale to Chinese."></a><a href="/feed.xml" class="feed button icon-rss_feed" aria-label="RSS Feed"></a><input type="checkbox" class="dark-mode-toggle" aria-label="dark-mode-switch"><a href="#" aria-label="Click to toggle darkmode." class="button"><span class="icon-moon"></span><span class="icon-sun"></span></a><a href="#" id="pwa-install" class="install button icon-install disabled" aria-label="Install as Web Application"><span>Install</span></a></div><ul class="social condensed"><li><a target="_blank" rel="noreferrer" href="https://github.com/DotIN13" aria-label="GitHub Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://www.facebook.com/peter.zhang.1466" aria-label="Facebook Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://twitter.com/DotIN13" aria-label="Twitter Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://space.bilibili.com/4471331" aria-label="Bilibili Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="icon-bilibili fa-stack-1x fa-inverse"></i></span></a></li></ul><nav class="navigation condensed"><ul><li><a href="/en-us/about/">About</a></li><li><a href="/archive">Archive</a></li></ul></nav><section class="about-footer condensed"><div><a href="https://icp.gov.moe" rel="noreferrer" target="_blank">Moe ICP </a><a href="https://icp.gov.moe/?keyword=20201620" target="_blank" rel="noreferrer">20201620</a></div><div><a rel="noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC-BY-SA 4.0</a></div></section></section><section class="content"><div class="post-container"><div class="multilingual-title"><a class="translate button" href="/2020/05/01/stop-propagation/"><i class="icon-translate"></i></a><a class="post-link" href="/en-us/2020/05/01/stop-propagation/"><h2 class="post-title">Onclick Not Working after Switching Pages? stopPropagation Saves the Day!</h2></a></div><a class="post-link" href="/en-us/2020/05/01/stop-propagation/"><h3 class="post-subtitle">切换页面后onclick不工作 stopPropagation来救场</h3></a><div class="post-meta"><div class="post-categories"><a class="button" href="/archive/?tag=JavaScript" title="JavaScript">JavaScript</a><a class="button" href="/archive/?tag=Blog" title="Blog">Blog</a></div><div class="post-misc"><div class="post-date"><i class="icon-calendar"></i>May 1, 2020</div></div></div><div class="post"><h2 id="plainwhite-theme"><a href="#plainwhite-theme">#</a> Plainwhite Theme </h2><p>After surfing the NET for a while, I found that there were really a lot of people using Hux Blog Jekyll theme, which was a solid proof the theme stands out both visually and pragmatically. But as it seemed everyone’s using it, I thought it would be a loss of personality if I kept it as well. So I scrolled through the Internet and switched to <a href="https://github.com/thelehhman/plainwhite-jekyll" target="_blank" rel="nofollow noopener noreferrer">@thelehhman’s Plainwhite</a>. The theme itself was great, however, it’s so simple that I had to add manually many features, such as the search bar.</p><div class="post-img"><a href="/assets/img/in-post/post-searchbar/searchbar.png" data-fancybox="gallery" data-caption="Plainwhite Searchbar" data-path="post-searchbar/searchbar.png" data-webpack="true"></a><em>Plainwhite Searchbar</em></div><p>I have previously implemented <a href="/2020/03/14/jekyll-blog-searchbar/">search module on Hux Blog</a>, so I had the experience. However, you can see that the Plainwhite theme is so minimalistic that I couldn’t decide where to hoist a search bar. Finally I decided to go with the <code class="language-plaintext highlighter-rouge">posts</code> label on the top of the page.</p><h2 id="dropdown-not-working-on-mobile-safari"><a href="#dropdown-not-working-on-mobile-safari">#</a> Dropdown Not Working on Mobile Safari </h2><p>My goal was to show the search bar and the results when I hover on the search sector, so naturally I thought of using CSS pseudoclass <code class="language-plaintext highlighter-rouge">:hover</code> &amp; <code class="language-plaintext highlighter-rouge">:hoverwithin</code> to implement such animations.</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code># HTML
<span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"posts-labelgroup"</span> <span class="na">id=</span><span class="s">"posts-labelgroup"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">"posts-label"</span> <span class="na">style=</span><span class="s">"width: 50px;"</span><span class="nt">&gt;</span>posts<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"search-container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"search-section"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"icon-search"</span><span class="nt">&gt;&lt;/i&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"search"</span> <span class="na">id=</span><span class="s">"searchbar"</span>
        <span class="na">autocomplete=</span><span class="s">"off"</span> <span class="na">aria-label=</span><span class="s">"search in posts"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"search-results"</span> <span class="na">id=</span><span class="s">"search-results"</span> <span class="na">data-placeholder=</span><span class="s">"NO RESULTS"</span> <span class="na">style=</span><span class="s">"display: none;"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</code></pre></div></div><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">#</span> <span class="nt">SCSS</span>
<span class="nc">.posts-labelgroup</span> <span class="p">{</span>
  <span class="c1">// searchbar style</span>
  <span class="k">&amp;</span><span class="nd">:focus-within</span> <span class="p">{</span>
    <span class="c1">// searchbar style on focus</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>It actually worked on PC and Android browsers, but sadly it doesn’t when it comes to Mobile Safari – when I clicked the results in the dropdown, no redirect was triggered. It looks like clicking stuff outside the search bar canceled <code class="language-plaintext highlighter-rouge">:focus</code> and <code class="language-plaintext highlighter-rouge">:focus-within</code>, rendering my clicks on the results futile. That’s a bit weird for it only appears on Safari.</p><p>After going through some posts on line, I learned other developer suggests that <code class="language-plaintext highlighter-rouge">:hover</code> doesn’t really make sense on mobile devices, and recommends JavaScript alternatives to cope with such issues.</p><p>Alas, VSCode, here I come!</p><h2 id="onclick-sometimes-not-working"><a href="#onclick-sometimes-not-working">#</a> Onclick “Sometimes Not Working” </h2><p>I started with a simple onclick event adding <code class="language-plaintext highlighter-rouge">focus-within</code> class to the outer <code class="language-plaintext highlighter-rouge">$labelGroup</code>, hoping the class could help render the desired animation with CSS.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">JavaScript</span> <span class="nx">Excerpt</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// add click eventlistener</span>
  <span class="nx">$labelGroup</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// animation to expand search results</span>
  <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

  <span class="nx">$labelGroup</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">mouseleave</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="nx">searchCollapse</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="kd">var</span> <span class="nx">searchCollapse</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// animation to collapse search results</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div><p>But when testing, I found that sometimes when I clicked <code class="language-plaintext highlighter-rouge">$labelGroup</code>, nothing happened other than the <code class="language-plaintext highlighter-rouge">input</code> getting focus. Shadows, search result dropdown and other animations didn’t work. I had to double click the search <code class="language-plaintext highlighter-rouge">input</code> to actually trigger the animation. The bug happens mostly when I switched to other browser tabs and went back. Though it’s not easy to trigger, it still bothers me, who is obviously an OCD patient.</p><h2 id="try-to-find-a-workaround"><a href="#try-to-find-a-workaround">#</a> Try to Find A Workaround </h2><p>I added <code class="language-plaintext highlighter-rouge">console.log()</code> to the callback of the click event, and it turned out that although the animation were not shown, the callback actually did get run. Most similar issues online didn’t have a running callback, so that made my issue even more mysterious. I tried numerous browsers and found that the issue wasn’t browser specific.</p><p>After trying hundreds of solutions I could find online, almost accidentally, I copied a chunk of code online, and I was astonished that the issue was gone! <strong>One will search high and low only to find it when one least expects to.</strong> The magic was with the <code class="language-plaintext highlighter-rouge">e.stopPropagation()</code>.</p><h2 id="dig-hard"><a href="#dig-hard">#</a> Dig Hard </h2><p>I had to mention JavaScript <a href="https://javascript.info/bubbling-and-capturing" target="_blank" rel="nofollow noopener noreferrer">Bubbling</a> to better illustrate the issue.</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;style&gt;</span>
  <span class="nt">body</span> <span class="o">*</span> <span class="p">{</span>
    <span class="nl">margin</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">blue</span><span class="p">;</span>
  <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;form</span> <span class="na">onclick=</span><span class="s">"alert('form')"</span><span class="nt">&gt;</span>FORM
  <span class="nt">&lt;div</span> <span class="na">onclick=</span><span class="s">"alert('div')"</span><span class="nt">&gt;</span>DIV
    <span class="nt">&lt;p</span> <span class="na">onclick=</span><span class="s">"alert('p')"</span><span class="nt">&gt;</span>P<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div><style>
  #code-tryout {
    border: solid 2px #f4f4f4;   
  }
  #code-tryout * {
    margin: 10px;
    border: 1px solid #268bd2;
  }
</style><div id="code-tryout"><form onclick="alert('form')">FORM <div onclick="alert('div')">DIV <p onclick="alert('p')">P (Click Me!)</p></div></form></div><p>When you trigger an event on an element, it would get passed to its parent elements (ancestors), all the way back to <code class="language-plaintext highlighter-rouge">document.body</code>, triggering the event on all of the elements on its way. The example above explains Bubbling well – when <code class="language-plaintext highlighter-rouge">&lt;p&gt;</code> is clicked, the click event on <code class="language-plaintext highlighter-rouge">&lt;p&gt;</code> would be triggered, then <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code>, then <code class="language-plaintext highlighter-rouge">&lt;form&gt;</code>.</p><p>Then what does that have to do with my search bar issue?</p><p>Following was two examples, one with <code class="language-plaintext highlighter-rouge">stopPropagation</code>, one without. In the falty example, the JavaScript first adds a click event for <code class="language-plaintext highlighter-rouge">input</code>, shows a sting when clicked, and then added a <code class="language-plaintext highlighter-rouge">mouseleave</code> event to the <code class="language-plaintext highlighter-rouge">input</code>, which would attach a click event to outer <code class="language-plaintext highlighter-rouge">div</code> to cancel the string display.</p><p>The problem here is as follows: when your mouse moves in and out the <code class="language-plaintext highlighter-rouge">input</code> without clicking it, JavaScript will add the <code class="language-plaintext highlighter-rouge">click</code> event to outer <code class="language-plaintext highlighter-rouge">div</code> anyways. Now you click the search bar, the click event of <code class="language-plaintext highlighter-rouge">input</code> triggers and show the string, however, in a time of milliseconds, the event gets bubbled to the outer <code class="language-plaintext highlighter-rouge">div</code> and triggers its event to cancel the string display. Two canceling events were triggered so close that human eye could never notice neither one of them.</p><p class="codepen" data-height="265" data-theme-id="light" data-default-tab="js,result" data-user="DotIN13" data-slug-hash="qBOXjWJ" style="height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="stopPropagation"><span>See the Pen <a href="https://codepen.io/DotIN13/pen/qBOXjWJ"> stopPropagation</a> by DotIN13 (<a href="https://codepen.io/DotIN13">@DotIN13</a>) on <a href="https://codepen.io">CodePen</a>.</span></p><script async="" src="https://static.codepen.io/assets/embed/ei.js"></script><p>Moving back to our blog search bar, when switching pages, the mouse was likely to pass the bar, creating a unwanted <code class="language-plaintext highlighter-rouge">click</code> event for the <code class="language-plaintext highlighter-rouge">document.body</code>. When switching back to the blog page, click on the search bar would trigger both the <code class="language-plaintext highlighter-rouge">search bar</code> and <code class="language-plaintext highlighter-rouge">document.body</code> events, canceling the effect of each other.</p><p>After getting to know the source of the issue, it would be easy to get rid of it. We just need to add a line of <code class="language-plaintext highlighter-rouge">e.stopPropagation();</code> to the search bar click callback, in order to stop the bubbling when search bar gets clicked.</p><h2 id="later"><a href="#later">#</a> Later </h2><p>Of course, the issue had other possible solutions, for instance, place <code class="language-plaintext highlighter-rouge">mouseleave</code> in the search bar <code class="language-plaintext highlighter-rouge">click</code> event to make sure it only gets created after click, and add code to remove <code class="language-plaintext highlighter-rouge">mouseleave</code> on <code class="language-plaintext highlighter-rouge">document.body.click</code>.</p><p>Coding is special itself. It is always a open question. The boundary of such a question is the infinite creativity and imagination of mankind.</p></div><ul class="post-pager"><li class="pager--next"><a class="button" href="/2020/05/10/minecraft-aliyun/" data-toggle="tooltip" data-placement="top" title="在阿里云ECS上搭建Minecraft原版服务器"> NEXT<br><span>在阿里云ECS上搭建Minecraft原版服务器</span></a></li><li class="pager--prev"><a class="button" href="/2020/05/01/stop-propagation/" data-toggle="tooltip" data-placement="top" title="切换页面后onclick不工作 stopPropagation来救场"> PREV<br><span>切换页面后onclick不工作 stopPropagation来救场</span></a></li></ul><div id="vcomments"></div></div></section><footer class="about condensed"><ul class="social condensed"><li><a target="_blank" rel="noreferrer" href="https://github.com/DotIN13" aria-label="GitHub Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://www.facebook.com/peter.zhang.1466" aria-label="Facebook Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://twitter.com/DotIN13" aria-label="Twitter Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="fab icon-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" rel="noreferrer" href="https://space.bilibili.com/4471331" aria-label="Bilibili Social Link"><span class="fa-stack fa-2x"><i class="fas icon-circle fa-stack-2x"></i><i class="icon-bilibili fa-stack-1x fa-inverse"></i></span></a></li></ul><nav class="navigation condensed"><ul><li><a href="/en-us/about/">About</a></li><li><a href="/archive">Archive</a></li></ul></nav><section class="about-footer condensed"><div><a href="https://icp.gov.moe" rel="noreferrer" target="_blank">Moe ICP </a><a href="https://icp.gov.moe/?keyword=20201620" target="_blank" rel="noreferrer">20201620</a></div><div><a rel="noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC-BY-SA 4.0</a></div></section></footer></main><script async src="https://www.googletagmanager.com/gtag/js?id=UA-159368053-1"></script><script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-159368053-1');
    </script></body></html>